# 96 - hc0n Christmas CTF (Padding Oracle Exploit, )

Room Link --> [https://tryhackme.com/room/hc0nchristmasctf](https://tryhackme.com/room/hc0nchristmasctf)

### Enumeration

{% code overflow="wrap" %}
```bash
nmap 10.10.227.191 -F -sV -vvv

22
80
8080
```
{% endcode %}

#### Gobuster Enum

{% code overflow="wrap" %}
```bash
gobuster dir -u http://10.10.227.191/ -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories.txt --no-error -t 500 -x php,sql,db,txt

/admin
/images
/classes
/javascript
/index.php
/header.php
/footer.php
/robots.txt
/hide-folders
```
{% endcode %}

<figure><img src=".gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

We have the username for the admin: `administratorhc0nwithyhackme`

&#x20; and a `iv.png` image with cicada 3301 as the hint.

We create a new account on the site.

<figure><img src=".gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

The cookie was strange:

<figure><img src=".gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

`q5JtuymZ1p3eWP3TrWsyaWul7SyR%2FYUv` - we see `%2F` ie `/` in ASCII.

So i forwarded to Repeater and changed the last letter in the cookie to `c` and got an error:

<figure><img src=".gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

Googling `Invalid padding` and found an [Hacktricks](https://book.hacktricks.xyz/crypto-and-stego/padding-oracle-priv) blog about `Padding Oracle` .

### Padding Oracle / Oracle Padding Exploitation

This exploit has to do with decrypting the encrypted cookie using a tool `sudo apt install padbuster` , on decrypting the cookie, we can be able to modify the value of the decrypted cookie, encrypt it back and use the newly encrypted cookie to login as another user or Hijack another user session.

{% code overflow="wrap" %}
```bash
padbuster http://10.10.227.191/login.php q5JtuymZ1p3eWP3TrWsyaWul7SyR%2FYUc 8 --cookies hcon=q5JtuymZ1p3eWP3TrWsyaWul7SyR%2FYUc --encoding 0 -plaintext user=administratorhc0nwithyhackme

# make sure to select 2, when the prompt comes up.
-------------------------------------------------------
** Finished ***

[+] Encrypted value is: u7oWkmr0TrKomnSFpCLrMmqypZ4zLdrKwG7XVt97a%2Bcvankk1KBpOgAAAAAAAAAA
-------------------------------------------------------
```
{% endcode %}

So if we replace our current user `hcon` cookie with this new cookie we are successfully logged in as Admin user. And get a key for the apk file.

<figure><img src=".gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

SecretKeySpec for the apk: `hconkwithyhackme`&#x20;

### The False APK

By referring to the admin page, it mentioned the Android package (APK). Indeed, you can find the apk at the /admin directory.

![admin](https://deskel.github.io/assets/images/THM/2020-08-15-hc0n-christmas-ctf/12.png)

Download and decompile the APK file, I come across one conclusion. The ciphertext is located at port 8080 and it is an AES-CBC block cipher.

![port](https://deskel.github.io/assets/images/THM/2020-08-15-hc0n-christmas-ctf/13.png)

![AES](https://deskel.github.io/assets/images/THM/2020-08-15-hc0n-christmas-ctf/14.png)

There is nothing you can do with the APK file, it just used to justify our finding on the secret key and IV.

### Port 8080

We get an encryped cipher:&#x20;

```
RwO9+7tuGJ3nc1cIhN4E31WV/qeYGLURrcS7K+Af85w=
```

### The IV, runic text and cicada 3301 <a href="#part-6-the-iv-runic-text-and-cicada-3301" id="part-6-the-iv-runic-text-and-cicada-3301"></a>

We need one more element to decode the ciphertext, the IV. If you referred to the robot.txt, the IV is with the iv.png.

![runic](https://deskel.github.io/assets/images/THM/2020-08-15-hc0n-christmas-ctf/16.png)

**This is a "Runic text"**. With cicada 3310 as hints, you can find the **runic** text translator on the [cicada 3301 2014 walkthrough](https://uncovering-cicada.fandom.com/wiki/Uncovering\_Cicada\_Wiki).

![runic translator](https://deskel.github.io/assets/images/THM/2020-08-15-hc0n-christmas-ctf/17.jpg)

The IV translated to **THEIVFORINGEOAEY**.

### Decoding the AES <a href="#part-7-decoding-the-aes" id="part-7-decoding-the-aes"></a>

With all the available information (Ciphertext, secret key and IV), we can proceed and decode the AES-CBC block ciphertext with an [online tool](https://www.devglan.com/online-tools/aes-encryption-decryption).

AES Decryption in Python -> [https://onboardbase.com/blog/aes-encryption-decryption/](https://onboardbase.com/blog/aes-encryption-decryption/)

<figure><img src=".gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

`user ssh <3 thedarktangent`&#x20;

### Finding the ssh password I (HTTP-request) <a href="#part-8-finding-the-password-i-http-request" id="part-8-finding-the-password-i-http-request"></a>

There is one more directory we yet to visit, which is the /hide-folders.

![hide](https://deskel.github.io/assets/images/THM/2020-08-15-hc0n-christmas-ctf/19.png)

Let’s take a visit on /1 and we will talk about /2 in the next part.

![method not allow](https://deskel.github.io/assets/images/THM/2020-08-15-hc0n-christmas-ctf/20.png)

By visiting the page, we get a 405 status code (Method not allowed). It must be have something to do with the incorrect request method.

Make sure you have your Burp suite (Or any relevant program) open. For burp suite, send the page request to the **repeater**. In default, the page request is GET.

![repeater](https://deskel.github.io/assets/images/THM/2020-08-15-hc0n-christmas-ctf/21.png)

We need to change the request from GET to OPTIONS.

<figure><img src=".gitbook/assets/image (6).png" alt=""><figcaption></figcaption></figure>

```
hax0r :3 you win firts part of the ssh password
Gf7MRr55
```

![hola](https://deskel.github.io/assets/images/THM/2020-08-15-hc0n-christmas-ctf/24.png)

There is one binary inside the /2 directory. Download it and open it up with IDA, R2, Ghidra or any RE program. For this challenge, I’m going to use GUI-based IDA. You don’t have to use any debugging feature on IDA, the username and the password are just sitting there.

<figure><img src=".gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

`n$@#PDuliL`

```
Gf7MRr55n$@#PDuliL
```



























