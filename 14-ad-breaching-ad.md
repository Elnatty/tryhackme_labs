# 14 - AD - Breaching AD

### Configuring DNS

#### My resolv.conf file Before:

{% code overflow="wrap" lineNumbers="true" %}
```bash
# Generated by NetworkManager
nameserver 8.8.8.8
```
{% endcode %}

#### My resolv.conf file After:

{% code overflow="wrap" lineNumbers="true" %}
```bash
# Generated by NetworkManager
nameserver 8.8.8.8
search google.com

search za.tryhackme.com
nameserver 10.200.26.101
```
{% endcode %}

Restart the NetworkManager:

`sudo systemctl restart NetworkManager`&#x20;

We should be able to do nslookup for the DC ip now.

```bash
nslookup thmdc.za.tryhackme.com
```

<figure><img src=".gitbook/assets/image (129).png" alt=""><figcaption></figcaption></figure>

### NTLM Authenticated Services

**New Technology LAN Manager (NTLM)** is the suite of security protocols used to authenticate users' identities in AD. NTLM can be used for authentication by using a challenge-response-based scheme called NetNTLM. This authentication mechanism is heavily used by the services on a network. However, services that use NetNTLM can also be exposed to the internet. The following are some of the popular examples:

* Internally-hosted Exchange (Mail) servers that expose an Outlook Web App (OWA) login portal.
* Remote Desktop Protocol (RDP) service of a server being exposed to the internet.
* Exposed VPN endpoints that were integrated with AD.
* Web applications that are internet-facing and make use of NetNTLM.

**NetNTLM**, also often referred to as Windows Authentication or just NTLM Authentication, allows the application to play the role of a middle man between the client and AD. All authentication material is forwarded to a Domain Controller in the form of a challenge, and if completed successfully, the application will authenticate the user.

This means that the application is authenticating on behalf of the user and not authenticating the user directly on the application itself. This prevents the application from storing AD credentials, which should only be stored on a Domain Controller. This process is shown in the diagram below:

\


<figure><img src="https://tryhackme-images.s3.amazonaws.com/user-uploads/6093e17fa004d20049b6933e/room-content/c9113ad0ff443dd0973736552e85aa69.png" alt=""><figcaption></figcaption></figure>

### Brute-force Login Attacks

Navigating to the URL, we can see that it prompts us for Windows Authentication credentials:

![](https://tryhackme-images.s3.amazonaws.com/user-uploads/6093e17fa004d20049b6933e/room-content/5f18e5326d5a50d656d1827221bdcac7.png)

\










































































